{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
    <div class="dashboard-header">
        <h2>Welcome back, {{ user.name }}! üëã</h2>
    </div>

    <div class="card">
        <h3>Today's Mission</h3>
        <p class="task-text">"{{ task.task_text }}"</p>
        <div class="task-item">
        <p>{{ task.description }}</p>
        <button class="ai-btn" onclick="getSuggestion('{{ task.description }}', this)">
    üí° AI Suggest
    </button>
  <div class="suggestion" style="margin-top:5px; color:#4CAF50;"></div>
</div>
    </div>

    <div class="card">
        <h3>Connect with Someone New</h3>
        <p>Enter the referral code of the person you met:</p>
        <form action="{{ url_for('add_connection') }}" method="POST" class="connect-form">
            <input type="text" name="referral_code" placeholder="Enter Referral Code" required>
            <button type="submit" class="btn">Connect</button>
        </form>
    </div>
    
    <div class="card">
        <h3>Recent Connections</h3>
        {% if connections %}
            <ul class="connections-list">
                {% for friend in connections %}
                    <li>{{ friend.name }}</li>
                {% endfor %}
            </ul>
             <a href="{{ url_for('connections') }}" class="view-all">View all connections &rarr;</a>
        {% else %}
            <p>You haven't made any connections yet. Use your daily task to meet someone!</p>
        {% endif %}
    </div>

    <script>
        async function getSuggestion(task, btn) {
        btn.innerText = "Thinking...";
        try {
            const res = await fetch("/ai_suggest", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ task })
        });
            const data = await res.json();
            if (data.suggestion) {
            btn.nextElementSibling.innerHTML = `<b>Suggestion:</b> ${data.suggestion}`;
        } else {
        btn.nextElementSibling.innerHTML = "‚ö†Ô∏è Failed to get suggestion.";
        }
    } catch (err) {
        btn.nextElementSibling.innerHTML = "‚ö†Ô∏è Error connecting to AI.";
    }
        btn.innerText = "üí° AI Suggest";
    }
    </script>

{% endblock %}